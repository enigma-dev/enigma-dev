show_debug_message("Starting the test");

myint8_t = 127;
myint16_t = 32767;
myint32_t = 2147483647;
myint64_t = 2147483647;
myuint8_t = 255;
myuint16_t = 65535;
myuint32_t = 4294967295;
myuint64_t = 4294967295;
mydouble = 1.23456789;

show_debug_message("Starting the saving");
var buf = buffer_create(1, buffer_grow, 1);
game_save_buffer(buf, SerializationBackend::Binary);
buffer_save(buf, "/tmp/test.bin");

myint8_t = -128;
myint16_t = -32768;
myint32_t = -2147483648;
myint64_t = -2147483648;
myuint8_t = 0;
myuint16_t = 0;
myuint32_t = 0;
myuint64_t = 0;
mydouble = -1.2345678901;

show_debug_message("Loading the file");
buffer_delete(buf);
buf = buffer_load("/tmp/test.bin");
game_load_buffer(buf, SerializationBackend::Binary);

gtest_assert_eq(int8_t(id.myint8_t), 127);
gtest_assert_eq(int16_t(id.myint16_t), 32767);
gtest_assert_eq(int32_t(id.myint32_t), 2147483647);
gtest_assert_eq(int64_t(id.myint64_t), 2147483647);
gtest_assert_eq(uint8_t(id.myuint8_t), 255);
gtest_assert_eq(uint16_t(id.myuint16_t), 65535);
gtest_assert_eq(uint32_t(id.myuint32_t), 4294967295);
gtest_assert_eq(uint64_t(id.myuint64_t), 4294967295);
gtest_assert_eq(double(id.mydouble), 1.23456789);

show_debug_message("Loading successful");

game_end();

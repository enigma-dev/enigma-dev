sudo: required
dist: trusty

notifications:
  #irc: "chat.freenode.net#enigma"

language: cpp

compiler:
  - gcc

git:
  depth: 1

cache:
  directories:
    - $TRAVIS_BUILD_DIR/blobs

jobs:
  include:
    - stage: prepare cache
      env: UPDATING_CACHE
      before_install: skip
      install:
        - sudo apt-get -qq -y install libboost-dev libboost-iostreams-dev libboost-filesystem-dev
            libboost-program-options-dev libboost-system-dev
        - make -j4
        - make -j4 emake
      script: skip
      before_cache:
        - mv libcompileEGMf.so cache/libcompileEGMf.so
        - mv emake cache/emake
stages:
  - prepare cache
  - test

before_install:
  # move our cached files back onto the relative path if they exist in the restored cache
  - mv blobs/libcompileEGMf.so ./
  - mv blobs/emake ./
  - sudo dpkg --add-architecture i386
  #- sudo apt-get -qq update
  #- sudo apt-get -qq -y install libglu1-mesa-dev
  - sudo apt-get -qq -y install libboost-dev libboost-iostreams-dev libboost-filesystem-dev
    libboost-program-options-dev libboost-system-dev
  - sudo apt-get -qq -y install zlib1g-dev
  - sudo apt-get -qq -y install libalure-dev
  - sudo apt-get -qq -y install libvorbisfile3
  - sudo apt-get -qq -y install libvorbis-dev 
  - sudo apt-get -qq -y install libdumb1-dev
  #- sudo apt-get -qq -y install libc++-dev
  - sudo apt-get -qq -y install libsfml-dev
  #- sudo apt-get -qq -y install libgtk2.0-dev
  - sudo apt-get -qq -y install libbullet-dev
  - sudo apt-get -qq -y install libbox2d-dev
  - sudo apt-get -qq -y install libgme-dev
  #- sudo apt-get -qq -y install gcc-multilib
  #- sudo apt-get -qq -y install g++-multilib
  #- sudo apt-get -qq -y install libc6:i386
  #- sudo apt-get -qq -y install libncurses5:i386
  #- sudo apt-get -qq -y install libstdc++6:i386
  #- sudo apt-get -qq -y install lib32z1-dev
  #- sudo apt-get -qq -y install libglu1-mesa:i386
  #- sudo apt-get -qq -y install libx11-6:i386
  #- sudo apt-get -qq -y install libc++-dev:i386
  #- sudo apt-get -qq -y install mingw-w64
  #- sudo apt-get -qq -y install wine

  # Ubuntu is a turd
  #- sudo ln -s /usr/lib/i386-linux-gnu/mesa/libGL.so.1 /usr/lib/i386-linux-gnu/libGL.so
  #- sudo ln -s /usr/lib/i386-linux-gnu/libX11.so.6 /usr/lib/i386-linux-gnu/libX11.so
  #- sudo ln -s /usr/lib/i386-linux-gnu/libGLU.so.1 /usr/lib/i386-linux-gnu/libGLU.so
  - sudo ln -s /usr/include/x86_64-linux-gnu/zconf.h /usr/include

install:
  - chmod +x ./ci-build.sh
  - curl -L https://github.com/fundies/enigma-libs/files/1347135/enigma-libs.zip > enigma-libs.zip
  - unzip enigma-libs.zip -d ENIGMAsystem/
  - mv ENIGMAsystem/Install ENIGMAsystem/Additional
env:
  global:
    - OUTPUT=/tmp/test
  matrix:
  #BEGIN LINUX
    # Game Modes
    - COMPILER=gcc PLATFORM=xlib MODE=Run GRAPHICS=OpenGL1 AUDIO=None COLLISION=None NETWORK=None WIDGETS=None EXTENSIONS="None"
    - COMPILER=gcc PLATFORM=xlib MODE=Debug GRAPHICS=OpenGL1 AUDIO=None COLLISION=None NETWORK=None WIDGETS=None EXTENSIONS="None"
    - COMPILER=gcc PLATFORM=xlib MODE=Compile GRAPHICS=OpenGL1 AUDIO=None COLLISION=None NETWORK=None WIDGETS=None EXTENSIONS="None"
  #END LINUX
script:
  - ./ci-build.sh

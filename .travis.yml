notifications:
  irc: "chat.freenode.net#enigma"
language: cpp

git:
  depth: 1

compiler:
  - gcc

# don't build "feature" branches
branches:
  only:
    - "master"

sudo: false
dist: trusty
osx_image: xcode9.2

addons:
  apt:
    packages:
    - build-essential 
    - libglu1-mesa-dev
    - zlib1g-dev
    - libboost-dev 
    - libboost-iostreams-dev 
    - libboost-filesystem-dev 
    - libboost-program-options-dev 
    - libboost-system-dev

before_install:
  # Ubuntu is a turd
  #- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo ln -s /usr/lib/i386-linux-gnu/mesa/libGL.so.1 /usr/lib/i386-linux-gnu/libGL.so; fi
  #- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo ln -s /usr/lib/i386-linux-gnu/libX11.so.6 /usr/lib/i386-linux-gnu/libX11.so; fi
  #- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo ln -s /usr/lib/i386-linux-gnu/libGLU.so.1 /usr/lib/i386-linux-gnu/libGLU.so; fi
  #- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo ln -s /usr/include/x86_64-linux-gnu/zconf.h /usr/include; fi
  
install:
  - chmod +x ./ci-build.sh
  - make -j4
  - make -j4 emake
  - curl -L https://github.com/fundies/enigma-libs/files/1347135/enigma-libs.zip > enigma-libs.zip
  - unzip enigma-libs.zip -d ENIGMAsystem/
  - mv ENIGMAsystem/Install ENIGMAsystem/Additional

env:
  global:
    - OUTPUT=/tmp/test
  
matrix:
  include:
#BEGIN OSX
  # Compilers
  - { os: osx,
      env: { COMPILER: "clang", PLATFORM: "None", MODE: "Debug", GRAPHICS: "None", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "None" } }
  - { os: osx,
      env: { COMPILER: "gcc", PLATFORM: "None", MODE: "Debug", GRAPHICS: "None", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "None" } }
#END OSX
 
#TRAVIS_SUDO
#BEGIN LINUX
  # Game Modes
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Run", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "None" } }
 
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "None" } }
      
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Compile", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "None" } }
  
  # Compilers
  - { os: linux,
      env: { COMPILER: "gcc32", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "None" } }
  
  - { os: linux,
      env: { COMPILER: "clang", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "None" } }
  
  - { os: linux,
      env: { COMPILER: "clang32", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "None" } }
  
  # Graphics
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL3", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "None" } }
  
  # Audio
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "OpenAL", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "None" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "SFML", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "None" } }
  
  # Networking
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "Asynchronous", WIDGETS: "None", EXTENSIONS: "None" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "BerkeleySockets", WIDGETS: "None", EXTENSIONS: "None" } }
  
  # Widgets
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "GTK+", EXTENSIONS: "None" } }
  
  # Collision
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "BBox", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "None" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "Precise", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "None" } }
  
  # Extensions
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "Alarms" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "DataStructures,Asynchronous" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "GTK+", EXTENSIONS: "BasicGUI" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "Box2DPhysics" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "BulletDynamics" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "DataStructures" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "DateTime" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "GM5Compat" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "OpenAL", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "GME" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "SFML", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "GME" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "IniFilesystem" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "DataStructures,Json" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "MatrixMath" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "BBox", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "Paths" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "BBox", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "Paths,MotionPlanning" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "Precise", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "Paths,MotionPlanning" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "ParticleSystems" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL3", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "ParticleSystems" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL3", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "StudioPhysics" } }
  
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "xlib", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "Timelines" } }
    
    # Cross Compile
  - { os: linux,
      env: { COMPILER: "MinGW32", PLATFORM: "Win32", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "None" } }
  
  - { os: linux,
      env: { COMPILER: "MinGW64", PLATFORM: "Win32", MODE: "Debug", GRAPHICS: "OpenGL1", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "None" } }
    
    # The big ol' "None", test.
  - { os: linux,
      env: { COMPILER: "gcc", PLATFORM: "None", MODE: "Debug", GRAPHICS: "None", AUDIO: "None", COLLISION: "None", NETWORK: "None", WIDGETS: "None", EXTENSIONS: "None" } }
#END LINUX

script:
  - ./ci-build.sh

# competition for Thundercleese
notifications:
  irc: "chat.freenode.net#enigma"
# disable the depth option for git allowing us to merge multiple prs simultaneously
git:
  depth: false
# don't build "feature" branches
branches:
  only:
    - "master"

before_install:
  - |
    if [ "$TRAVIS_OS_NAME" == "linux" ]; then
      sudo dpkg --add-architecture i386;

      sudo apt-get -qq -y install build-essential zlib1g-dev libboost-dev libboost-iostreams-dev\
        libboost-filesystem-dev libboost-program-options-dev libboost-system-dev;

      if [ "$COMPILER" == "gcc32" ] || [ "$COMPILER" == "clang32" ]; then
        sudo apt-get -qq -y install libc++-dev:i386 libglu1-mesa:i386\
          libc6:i386 libncurses5:i386 libstdc++6:i386 lib32z1-dev libx11-6:i386;

        if [ "$COMPILER" == "gcc32" ]; then
          sudo apt-get -qq -y install gcc-multilib g++-multilib;
        fi

        sudo ln -s /usr/lib/i386-linux-gnu/mesa/libGL.so.1 /usr/lib/i386-linux-gnu/libGL.so;
        sudo ln -s /usr/lib/i386-linux-gnu/libX11.so.6 /usr/lib/i386-linux-gnu/libX11.so;
        sudo ln -s /usr/lib/i386-linux-gnu/libGLU.so.1 /usr/lib/i386-linux-gnu/libGLU.so;
      elif  [ "$COMPILER" == "MinGW64" ]; then
        sudo apt-get -qq -y install mingw-w64 wine;
      else
        sudo apt-get -qq -y install libc++-dev libglu1-mesa-dev;
      fi

      sudo ln -s /usr/include/x86_64-linux-gnu/zconf.h /usr/include;
    elif [ "$TRAVIS_OS_NAME" == "osx" ]; then
      brew upgrade gcc || brew install gcc || brew link --overwrite gcc;
    fi

install:
  - chmod +x ./ci-build.sh
  - make -j4
  - make -j4 emake
  - curl -L https://github.com/fundies/enigma-libs/files/1347135/enigma-libs.zip > enigma-libs.zip
  - unzip enigma-libs.zip -d ENIGMAsystem/
  - mv ENIGMAsystem/Install ENIGMAsystem/Additional

# by default most of our jobs will be run on a linux instance
os: linux
dist: trusty
compiler: gcc
language: cpp

env:
  global:
    - OUTPUT=/tmp/test
  matrix:
    - COMPILER=gcc PLATFORM=xlib MODE=Debug GRAPHICS=OpenGL1 AUDIO=None COLLISION=None NETWORK=None WIDGETS=None EXTENSIONS="None"
    - COMPILER=gcc32 PLATFORM=xlib MODE=Debug GRAPHICS=OpenGL1 AUDIO=None COLLISION=None NETWORK=None WIDGETS=None EXTENSIONS="None"
    - COMPILER=clang PLATFORM=xlib MODE=Debug GRAPHICS=OpenGL1 AUDIO=None COLLISION=None NETWORK=None WIDGETS=None EXTENSIONS="None"
    - COMPILER=clang32 PLATFORM=xlib MODE=Debug GRAPHICS=OpenGL1 AUDIO=None COLLISION=None NETWORK=None WIDGETS=None EXTENSIONS="None"
    - COMPILER=MinGW32 PLATFORM=Win32 MODE=Run GRAPHICS=OpenGL1 AUDIO=None COLLISION=None NETWORK=None WIDGETS=None EXTENSIONS="None"
    - COMPILER=MinGW64 PLATFORM=Win32 MODE=Run GRAPHICS=OpenGL1 AUDIO=None COLLISION=None NETWORK=None WIDGETS=None EXTENSIONS="None"
script:
  - ./ci-build.sh

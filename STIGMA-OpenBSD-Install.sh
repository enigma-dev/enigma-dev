#!/bin/sh
su -l root -c '/bin/sh -c "pkg_add -u && pkg_add curl wget git llvm gcc-11.2.0p0 gdb gmake cmake pkgconf protobuf protobuf-c lzlib glew glm meson png libvpx openal libogg libsndfile libvorbis vorbis-tools dumb sdl2 freetype libffi jdk-1.8.0.302.b08.1p0v0 jna libyaml boost pugixml yaml-cpp zenity kdialog && git clone --recurse-submodules -j8 https://github.com/time-killer-games/stigma-dev /usr/local/bin/stigma-dev && ln -s /usr/local/include/google /usr/local/bin/stigma-dev/shared/protos/google && ln -s /usr/local/include/google /usr/local/bin/stigma-dev/CommandLine/emake/google && cd /usr/local/bin/stigma-dev/shared/protos && cd /usr/local/bin/stigma-dev/shared && git clone https://github.com/grpc/grpc && cd grpc && git submodule update --init && mkdir -p cmake/build && cd cmake/build && cmake ../.. && find CMakeFiles/grpc_cpp_plugin.dir/ -type f -exec sed -i 's/-lrt//g' {} \; && make grpc_cpp_plugin && find CMakeFiles/grpc++.dir/ -type f -exec sed -i 's/-lrt//g' {} \; && make grpc++ && ln -s ../grpc/third_party/abseil-cpp/absl /usr/local/bin/stigma-dev/shared/protos/absl && ln -s ../grpc/include/grpcpp /usr/local/bin/stigma-dev/shared/protos/grpcpp ln -s ../grpc/include/grpc && ln -s ../grpc/include/grpcpp /usr/local/bin/stigma-dev/shared/protos/grpc++ && /usr/local/bin/stigma-dev/shared/protos/grpcpp && cd /usr/local/bin/stigma-dev && env PATH=$PATH:./stigma-dev/shared/grpc/cmake/build CC=/usr/local/bin/clang CXX=/usr/local/bin/clang++ gmake clean && env PATH=$PATH:./stigma-dev/shared/grpc/cmake/build CC=/usr/local/bin/clang CXX=/usr/local/bin/clang++ gmake && env PATH=$PATH:./stigma-dev/shared/grpc/cmake/build CC=/usr/local/bin/clang CXX=/usr/local/bin/clang++ gmake && chmod +x /usr/local/bin/stigma-dev/install.sh && /usr/local/bin/stigma-dev/install.sh && rm -f /usr/local/bin/stigma-dev/plugins/shared/jna.jar && ln -s /usr/local/share/java/classes/jna.jar /usr/local/bin/stigma-dev/plugins/shared/jna.jar && cp -f /usr/local/bin/stigma-dev/stigma-dev-alt.desktop /usr/local/share/applications/stigma-dev.desktop && chmod +x /usr/local/share/applications/stigma-dev.desktop"' && rm -rf ~/.enigma && mkdir -p ~/.enigma/Preprocessor_Environment_Editable && echo "Installation Complete! You may now run the \"stigma-dev.desktop\" Desktop Entry!"
